<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:jdbc="http://www.springframework.org/schema/jdbc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/aop
           http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-3.0.xsd
           http://www.springframework.org/schema/jdbc
           http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd">
      
     <context:annotation-config />

	<!-- ********************************************************************************************** -->
	<!-- Configuration of Datasource                   -->
	<!-- ********************************************************************************************** -->
 
	<jdbc:embedded-database id="HsqldbDataSource" type="HSQL">
		<jdbc:script location="classpath:/bpse-sample-medium-testSchema.sql"/>
		<jdbc:script location="classpath:/bpse-sample-medium-testData.sql"/>
	</jdbc:embedded-database>
 
	<bean class="org.springframework.jdbc.core.simple.SimpleJdbcTemplate">
		<constructor-arg ref="HsqldbDataSource" />
	</bean>
	
	<!-- This Transaction Manager is needed for SQL Transactions: it uses a SQL Datasource (see above) -->
    <bean id="TransactionManager"
        class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="HsqldbDataSource" />
    </bean>

  	<!-- ********************************************************************************************** -->
    <!-- Configuration of Data Access Objects and injection of session and transaction manager          -->
    <!-- ********************************************************************************************** -->
    <!-- Complete Bean Lifecycle Management here: including initialisation and destroying -->
    
    <bean id="StudentDAO"
        class="at.ac.tuwien.ifs.bpse.dao.JdbcStudentDAO"
        scope="singleton" init-method="init" destroy-method="destroy">
        <!-- This is the datasource needed for JDBC Database Access -->
        <property name="dataSource" ref="HsqldbDataSource" />
        <!-- This is the transaction manager needed for SQL Transactions -->
        <property name="transactionManager" ref="TransactionManager" />
        <!-- The next properties are SQL Commands used in this DAO -->
        <property name="sql_selectAllStudents">
            <value>
                select id, matnr, firstname, lastname, email from
                student
            </value>
        </property>
        <property name="sql_selectStudent">
            <value>
                select id, matnr, firstname, lastname, email from
                student where id=?
            </value>
        </property>
        <property name="sql_insertStudent">
            <value>
                INSERT INTO student (matnr, firstname, lastname, email)
                values (?, ?, ?, ?)
            </value>
        </property>
        <property name="sql_updateStudent">
            <value>
                UPDATE student SET matnr=?, firstname=?, lastname=?,
                email=? WHERE id=?
            </value>
        </property>
        <property name="sql_deleteStudent">
            <value>DELETE FROM student WHERE id=?</value>
        </property>
        <property name="sql_getInsertId">
            <value>CALL IDENTITY()</value>
        </property>
    </bean>
    
    <!-- ********************************************************************************************** -->
    <!-- Model Beans Testdata                                                                           -->
    <!-- ********************************************************************************************** -->

	<bean id="StudentAlexanderSchatten"
        class="at.ac.tuwien.ifs.bpse.domain.Student">
        <property name="id" value="1" />
        <property name="matnr" value="8925164" />
        <property name="firstname" value="Alexander" />
        <property name="lastname" value="Schatten" />
        <property name="email" value="alexander@schatten.info" />
    </bean>

    <bean id="StudentDelete"
        class="at.ac.tuwien.ifs.bpse.domain.Student">
        <description>
            A Student for testing the DELETE method
        </description>
        <property name="id" value="40" />
        <property name="matnr" value="0027226" />
        <property name="firstname" value="Bender" />
        <property name="lastname" value="Rodrigues2" />
        <property name="email"
            value="bender@info.com" />
    </bean>

    <bean id="StudentUpdate"
        class="at.ac.tuwien.ifs.bpse.domain.Student">
        <description>
            A Student for testing the UPDATE method
        </description>
        <property name="id" value="41" />
        <property name="matnr" value="0926759" />
        <property name="firstname" value="Test" />
        <property name="lastname" value="Student" />
        <property name="email"
            value="test.student@qse.ifs.tuwien.ac.at" />
    </bean>

    <bean id="StudentGet"
        class="at.ac.tuwien.ifs.bpse.domain.Student">
        <description>
            A Student for testing the SELECT method
        </description>
        <property name="id" value="42" />
        <property name="matnr" value="8027164" />
        <property name="firstname" value="Alex" />
        <property name="lastname" value="Rodrigues" />
        <property name="email" value="alex.r@info.com" />
    </bean>

    <bean id="StudentAdd"
        class="at.ac.tuwien.ifs.bpse.domain.Student">
        <description>
            A Student for testing the INSERT method
        </description>
        <property name="id" value="2" />
        <property name="matnr" value="8765432" />
        <property name="firstname" value="Hubert" />
        <property name="lastname" value="Meixner" />
        <property name="email" value="hubert@meixner.test" />
    </bean>
    
    <bean id="CourseUpdateDelete"
        class="at.ac.tuwien.ifs.bpse.domain.Course">
        <description>
            A Course for testting the UPDATE and DELETE method
        </description>
        <property name="id" value="2" />
        <property name="title" value="ASE" />
        <property name="ects" value="3.5" />
    </bean>

    <bean id="CourseGet"
        class="at.ac.tuwien.ifs.bpse.domain.Course">
        <description>
            A Course for testting the SELECT method
        </description>
        <property name="id" value="2" />
        <property name="title" value="SEPM" />
        <property name="ects" value='4.5' />
    </bean>

    <bean id="CourseAdd"
        class="at.ac.tuwien.ifs.bpse.domain.Course">
        <description>
            A Course for testing the INSERT method
        </description>
        <property name="id" value="509" />
        <property name="title" value="ASE" />
        <property name="ects" value="6.5" />
    </bean>
    
    <bean id="ProfessorUpdateDelete"
        class="at.ac.tuwien.ifs.bpse.domain.Professor">
        <description>
            A Professor for testting the UPDATE and DELETE method
        </description>
        <property name="id" value="3" />
        <property name="officenr" value="188" />
        <property name="firstname" value="Assi" />
        <property name="lastname" value="1" />
        <property name="email" value="assi@info.com" />
    </bean>

    <bean id="ProfessorGet"
        class="at.ac.tuwien.ifs.bpse.domain.Professor">
        <description>
            A Professor for testting the SELECT method
        </description>
        <property name="id" value="3" />
        <property name="officenr" value="188" />
        <property name="firstname" value="Assi" />
        <property name="lastname" value="1" />
        <property name="email" value="assi@info.com" />
    </bean>
	
    <bean id="ProfessorAdd"
        class="at.ac.tuwien.ifs.bpse.domain.Professor">
        <description>
            A Professor for testing the INSERT method
        </description>
        <property name="id" value="2" />
        <property name="officenr" value="8765432" />
        <property name="firstname" value="Hubert" />
        <property name="lastname" value="Meixner" />
        <property name="email" value="hubert@meixner.test" />
    </bean>
    
    <bean id="ExamUpdateDelete"
        class="at.ac.tuwien.ifs.bpse.domain.Exam">
        <description>
            A Exam for testting the UPDATE and DELETE method
        </description>
        <property name="id" value="509" />
        <property name="location" value="Buero" />
        <property name="exdate"> <value type="java.util.Date">2008-08-08 20:08:08</value> </property>
        <property name="course" ref="CourseGet" />
    </bean>

    <bean id="ExamGet"
        class="at.ac.tuwien.ifs.bpse.domain.Exam">
        <description>
            A Exam for testting the SELECT method
        </description>
        <property name="id" value="509" />
        <property name="location" value="Frogger" />
        <property name="exdate"> <value type="java.util.Date">2008-08-08 20:08:08</value> </property>
        <property name="course" ref="CourseGet" />
    </bean>

	<bean id="customEditorConfigurer"
		class="org.springframework.beans.factory.config.CustomEditorConfigurer">
		<property name="customEditors">
			<map>
				<entry key="java.util.Date">
					<bean class="org.springframework.beans.propertyeditors.CustomDateEditor">
						<constructor-arg index="0">
							<bean class="java.text.SimpleDateFormat">
								<constructor-arg value="yyy-dd-mm hh:mm:ss" />
							</bean>
						</constructor-arg>
						<constructor-arg index="1" value="false" />
					</bean>
				</entry>
			</map>
		</property>
	</bean>

    <bean id="ExamAdd"
        class="at.ac.tuwien.ifs.bpse.domain.Exam">
        <description>
            A Exam for testing the INSERT method
        </description>
         <property name="id" value="510" />
        <property name="location" value="Buero 2" />
        <property name="exdate"> <value type="java.util.Date">2008-08-08 20:08:08</value> </property>
        <property name="course" ref="CourseGet" />
    </bean>
    
</beans>
